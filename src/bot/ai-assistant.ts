import Groq from "groq-sdk";

export async function chatWithAI(
  userMessage: string,
  username: string
): Promise<string> {
  if (!process.env.GROQ_API_KEY) {
    return `ูุฑุญุจุงู ${username}! ๐

ุฃูุง <b>ุงููุณุงุนุฏ ุงูุฐูู</b> ๐ค
ููู ูููููู ูุณุงุนุฏุชูุ

๐ฑ ุฃุฑุณู ุฑูู ูุงุชู ููุจุญุซ
๐ ุฃุฑุณู Facebook ID ููุจุญุซ
โ ุงุณุฃููู ุนู ุงูุจูุช`;
  }

  try {
    const groq = new Groq({ apiKey: process.env.GROQ_API_KEY });
    
    const completion = await groq.chat.completions.create({
      model: "llama-3.3-70b-versatile",
      messages: [
        {
          role: "system",
          content: `ุฃูุช ูุณุงุนุฏ ุฐูู ูุจูุช ุงูุจุญุซ ุนู ุฃุฑูุงู ุงูููุงุชู ูู ูุตุฑ. ุงุณูู "ุงููุณุงุนุฏ ุงูุฐูู".

ููุงุนุฏ ูููุฉ:
- ูู ูุฏูุฏุงู ูููุฐุจุงู ููุณุงุนุฏุงู
- ุงูุชุจ ุจุงูุนุฑุจูุฉ ุฏุงุฆูุงู
- ุฅุฌุงุจุงุชู ูุตูุฑุฉ ููุฎุชุตุฑุฉ (2-3 ุฌูู ูุญุฏ ุฃูุตู)
- ุงุณุชุฎุฏู ุงูุฅูููุฌู ุจุทุฑููุฉ ุงุญุชุฑุงููุฉ
- ูุง ุชุนุทู ูุนูููุงุช ุฎุงุทุฆุฉ ุนู ุงูุจูุช

ูุนูููุงุช ุงูุจูุช:
โ ูุจุญุซ ูู ููุงุนุฏ ุจูุงูุงุช ูุตุฑูุฉ
โ ูุฏุนู ุฃุฑูุงู ุงูููุงุชู ู Facebook IDs
โ ุงุดุชุฑุงู VIP: ุฌููุน ุงูููุงุนุฏ
โ ุงุดุชุฑุงู ุนุงุฏู: Facebook ููุท
โ ููุงุดุชุฑุงู: ุชูุงุตู ูุน ุงูุฏุนู

ุงูุฃูุงูุฑ:
/start - ุงูุจุฏุก
/help - ุงููุณุงุนุฏุฉ  
/status - ุญุงูุฉ ุงูุงุดุชุฑุงู

ุนูุฏ ุงูุณุคุงู ุนู ููููุฉ ุงูุจุญุซ:
- ุฃุฑุณู ุฑูู ุงููุงุชู ูุจุงุดุฑุฉ (ูุซู: 01234567890)
- ุฃู ุฃุฑุณู Facebook ID (ูุซู: 100007800548113)`,
        },
        {
          role: "user",
          content: userMessage,
        },
      ],
      max_tokens: 300,
      temperature: 0.7,
    });

    return completion.choices[0]?.message?.content || `ูุฑุญุจุงู ${username}! ๐

ููู ูููููู ูุณุงุนุฏุชูุ
๐ฑ ุฃุฑุณู ุฑูู ููุจุญุซ
โ ุงุณุฃููู ุนู ุงูุจูุช`;
  } catch (error) {
    console.error("โ [AI] Error:", error);
    return `ูุฑุญุจุงู ${username}! ๐

ููู ูููููู ูุณุงุนุฏุชูุ
๐ฑ ุฃุฑุณู ุฑูู ููุจุญุซ
โ ุงุณุฃููู ุนู ุงูุจูุช`;
  }
}
